<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Ultimate Clock</title>
<style>
  :root {
    --bg: linear-gradient(135deg, #e3f2fd, #ffffff);
    --text: #1c1c1e;
    --glass-bg: rgba(255,255,255,0.3);
    --border: rgba(255,255,255,0.4);
    --shadow: rgba(0,0,0,0.1);
  }
  [data-theme='dark'] {
    --bg: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    --text:#f5f5f7;
    --glass-bg: rgba(0,0,0,0.25);
    --border: rgba(255,255,255,0.15);
    --shadow: rgba(0,0,0,0.6);
  }
  body{
    margin:0;
    font-family:-apple-system,BlinkMacSystemFont,'SF Pro Display','Poppins',sans-serif;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    min-height:100vh;
    background:var(--bg);
    color:var(--text);
    transition:0.5s;
  }
  .clock-container{
    background:var(--glass-bg);
    backdrop-filter:blur(20px) saturate(180%);
    -webkit-backdrop-filter:blur(20px) saturate(180%);
    border-radius:25px;
    border:1px solid var(--border);
    box-shadow:0 8px 40px var(--shadow);
    padding:30px;
    display:flex;
    flex-direction:column;
    align-items:center;
    width:90%;
    max-width:340px;
    transition:0.4s;
  }
  h1{font-size:clamp(1.3rem,2vw,1.6rem);margin-bottom:15px;font-weight:600;}
  canvas{background:transparent;border-radius:50%;margin-bottom:20px;width:100%;height:auto;}
  select,input{
    padding:10px 14px;
    font-size:16px;
    border-radius:10px;
    border:1px solid var(--border);
    background:rgba(255,255,255,0.25);
    color:var(--text);
    margin-bottom:15px;
    width:100%;
    max-width:300px;
    backdrop-filter:blur(10px);
    outline:none;
    transition:0.3s;
  }
  input::placeholder{color:rgba(100,100,100,0.7);}
  #digitalTime{
    font-size:clamp(20px,4vw,28px);
    font-weight:500;
    margin-top:10px;
    padding:8px 16px;
    border-radius:12px;
    backdrop-filter:blur(6px);
    background:rgba(255,255,255,0.1);
  }
  .theme-toggle{
    position:fixed;
    top:20px;
    right:20px;
    background:var(--glass-bg);
    border:1px solid var(--border);
    border-radius:25px;
    padding:10px 18px;
    cursor:pointer;
    font-size:14px;
    color:var(--text);
    backdrop-filter:blur(15px);
    transition:0.3s;
  }
  .theme-toggle:hover{background:rgba(255,255,255,0.4);}
</style>
</head>
<body>
<button class="theme-toggle" id="themeToggle">🌙 Dark</button>
<div class="clock-container">
  <h1>The Ultimate Clock</h1>
  <input type="text" id="searchInput" placeholder="Search city or country...">
  <select id="countrySelect"></select>
  <canvas id="clockCanvas" width="280" height="280"></canvas>
  <div id="digitalTime"></div>
</div>

<script>
const canvas=document.getElementById('clockCanvas');
const ctx=canvas.getContext('2d');
const digitalTime=document.getElementById('digitalTime');
const countrySelect=document.getElementById('countrySelect');
const themeToggle=document.getElementById('themeToggle');
const searchInput=document.getElementById('searchInput');

const timezones={
  'Local Time':Intl.DateTimeFormat().resolvedOptions().timeZone,
  'United States (New York)':'America/New_York',
  'United Kingdom (London)':'Europe/London',
  'India (New Delhi)':'Asia/Kolkata',
  'Japan (Tokyo)':'Asia/Tokyo',
  'Australia (Sydney)':'Australia/Sydney',
  'UAE (Dubai)':'Asia/Dubai',
  'Germany (Berlin)':'Europe/Berlin',
  'Brazil (Sao Paulo)':'America/Sao_Paulo'
};

for(let country in timezones){
  const option=document.createElement('option');
  option.value=timezones[country];
  option.textContent=country;
  countrySelect.appendChild(option);
}

let selectedZone=Intl.DateTimeFormat().resolvedOptions().timeZone;
let serverTimeOffset=0;

async function syncTime(){
  try{
    const response=await fetch(`https://worldtimeapi.org/api/timezone/${selectedZone}`);
    if(!response.ok) throw new Error('Time fetch failed');
    const data=await response.json();
    const serverTime=new Date(data.datetime).getTime();
    serverTimeOffset=serverTime-Date.now();
  }catch(e){
    console.warn('Time sync failed, using local time',e);
    serverTimeOffset=0;
  }
}

async function startClock(){
  await syncTime();
  requestAnimationFrame(drawClock);
  setInterval(syncTime,60000);
}

function drawClock(){
  const now=new Date(Date.now()+serverTimeOffset);
  const radius=canvas.height/2;

  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.save();
  ctx.translate(radius,radius);

  drawFace(ctx,radius);
  drawNumbers(ctx,radius);
  drawTime(ctx,radius,now);

  ctx.restore();

  digitalTime.textContent=now.toLocaleTimeString('en-US',{timeZone:selectedZone,hour12:true});

  requestAnimationFrame(drawClock);
}

function drawFace(ctx,radius){
  ctx.beginPath();
  ctx.arc(0,0,radius*0.95,0,2*Math.PI);
  ctx.fillStyle='rgba(255,255,255,0.05)';
  ctx.fill();
  ctx.strokeStyle='rgba(255,255,255,0.4)';
  ctx.lineWidth=radius*0.04;
  ctx.stroke();
}

function drawNumbers(ctx,radius){
  ctx.font=radius*0.15+'px SF Pro Display';
  ctx.textBaseline='middle';
  ctx.textAlign='center';
  ctx.fillStyle=getComputedStyle(document.body).getPropertyValue('--text');
  for(let num=1;num<=12;num++){
    const ang=num*Math.PI/6;
    ctx.rotate(ang);
    ctx.translate(0,-radius*0.8);
    ctx.rotate(-ang);
    ctx.fillText(num.toString(),0,0);
    ctx.rotate(ang);
    ctx.translate(0,radius*0.8);
    ctx.rotate(-ang);
  }
}

function drawTime(ctx,radius,now){
  const ms=now.getMilliseconds();
  const second=now.getSeconds()+ms/1000;
  const minute=now.getMinutes()+second/60;
  const hour=(now.getHours()%12)+minute/60;
  drawHand(ctx,hour*Math.PI/6,radius*0.5,radius*0.07);
  drawHand(ctx,minute*Math.PI/30,radius*0.75,radius*0.06);
  drawHand(ctx,second*Math.PI/30,radius*0.85,radius*0.02,'#ff3b30');
}

function drawHand(ctx,pos,length,width,color=getComputedStyle(document.body).getPropertyValue('--text')){
  ctx.beginPath();
  ctx.lineWidth=width;
  ctx.lineCap='round';
  ctx.strokeStyle=color;
  ctx.moveTo(0,0);
  ctx.rotate(pos);
  ctx.lineTo(0,-length);
  ctx.stroke();
  ctx.rotate(-pos);
}

// Event listeners
countrySelect.addEventListener('change',async e=>{
  selectedZone=e.target.value;
  await syncTime();
});

themeToggle.addEventListener('click',()=>{
  if(document.body.getAttribute('data-theme')==='dark'){
    document.body.removeAttribute('data-theme');
    themeToggle.textContent='🌙 Dark';
  }else{
    document.body.setAttribute('data-theme','dark');
    themeToggle.textContent='☀️ Light';
  }
});

searchInput.addEventListener('input',()=>{
  const filter=searchInput.value.toLowerCase();
  Array.from(countrySelect.options).forEach(opt=>{
    opt.style.display=opt.textContent.toLowerCase().includes(filter)?'block':'none';
  });
});

// Auto select local timezone if available
if(navigator.geolocation){
  navigator.geolocation.getCurrentPosition(()=>{
    try{
      const tz=Intl.DateTimeFormat().resolvedOptions().timeZone;
      selectedZone=tz;
      countrySelect.value=tz;
      syncTime();
    }catch(e){console.warn(e);}
  });
}

startClock();
</script>
</body>
</html>
