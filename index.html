<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Apple Style Internet Synced Clock</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background: var(--bg);
      color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Poppins', sans-serif;
      text-align: center;
      transition: background 0.3s, color 0.3s;
      margin: 0;
    }

    :root {
      --bg: #f5f5f7;
      --text: #1c1c1e;
      --card-bg: #ffffff;
      --border: #ccc;
    }

    [data-theme='dark'] {
      --bg: #1c1c1e;
      --text: #f5f5f7;
      --card-bg: #2c2c2e;
      --border: #444;
    }

    .clock-container {
      background: var(--card-bg);
      border-radius: 20px;
      box-shadow: 0 4px 30px rgba(0,0,0,0.1);
      padding: 30px;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: background 0.3s;
      width: 90%;
      max-width: 340px;
    }

    h1 {
      font-size: clamp(1.2rem, 2vw, 1.5rem);
      margin-bottom: 10px;
      font-weight: 600;
    }

    canvas {
      background: var(--card-bg);
      border: 3px solid var(--border);
      border-radius: 50%;
      box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
      width: 100%;
      height: auto;
    }

    select {
      padding: 10px 14px;
      font-size: 16px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--card-bg);
      color: var(--text);
      transition: background 0.3s, color 0.3s;
      margin-bottom: 20px;
      width: 100%;
      max-width: 300px;
    }

    #digitalTime {
      font-size: clamp(20px, 4vw, 28px);
      font-weight: 500;
      margin-top: 10px;
      word-wrap: break-word;
    }

    .theme-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 8px 16px;
      cursor: pointer;
      font-size: 14px;
      color: var(--text);
      transition: background 0.3s;
    }

    .theme-toggle:hover {
      background: var(--border);
    }

    @media (max-width: 600px) {
      .clock-container {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <button class="theme-toggle" id="themeToggle">üåô Dark</button>

  <div class="clock-container">
    <h1>World Clock</h1>
    <select id="countrySelect"></select>
    <canvas id="clockCanvas" width="280" height="280"></canvas>
    <div id="digitalTime"></div>
  </div>

  <script>
    const canvas = document.getElementById('clockCanvas');
    const ctx = canvas.getContext('2d');
    const digitalTime = document.getElementById('digitalTime');
    const countrySelect = document.getElementById('countrySelect');
    const themeToggle = document.getElementById('themeToggle');

    const timezones = {
      'Local Time': Intl.DateTimeFormat().resolvedOptions().timeZone,
      'United States (New York)': 'America/New_York',
      'United Kingdom (London)': 'Europe/London',
      'India (New Delhi)': 'Asia/Kolkata',
      'Japan (Tokyo)': 'Asia/Tokyo',
      'Australia (Sydney)': 'Australia/Sydney',
      'UAE (Dubai)': 'Asia/Dubai',
      'Germany (Berlin)': 'Europe/Berlin',
      'Brazil (Sao Paulo)': 'America/Sao_Paulo'
    };

    for (let country in timezones) {
      const option = document.createElement('option');
      option.value = timezones[country];
      option.textContent = country;
      countrySelect.appendChild(option);
    }

    let selectedZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
    let serverTimeOffset = 0;

    async function syncWithInternetTime() {
      try {
        const response = await fetch(`https://worldtimeapi.org/api/timezone/${selectedZone}`);
        const data = await response.json();
        const serverTime = new Date(data.datetime).getTime();
        const localNow = Date.now();
        serverTimeOffset = serverTime - localNow;
      } catch (error) {
        console.error('Time sync failed:', error);
      }
    }

    async function startClock() {
      await syncWithInternetTime();
      drawClock();
      setInterval(syncWithInternetTime, 60000); // Sync every 60 seconds
    }

    function drawClock() {
      const now = new Date(Date.now() + serverTimeOffset);
      const radius = canvas.height / 2;
      ctx.translate(radius, radius);
      ctx.clearRect(-radius, -radius, canvas.width, canvas.height);

      drawFace(ctx, radius);
      drawNumbers(ctx, radius);
      drawTime(ctx, radius, now);

      ctx.translate(-radius, -radius);

      const timeString = now.toLocaleTimeString('en-US', { timeZone: selectedZone, hour12: true });
      digitalTime.textContent = timeString;

      requestAnimationFrame(drawClock);
    }

    function drawFace(ctx, radius) {
      ctx.beginPath();
      ctx.arc(0, 0, radius * 0.95, 0, 2 * Math.PI);
      ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--card-bg');
      ctx.fill();
      ctx.strokeStyle = getComputedStyle(document.body).getPropertyValue('--border');
      ctx.lineWidth = radius * 0.05;
      ctx.stroke();
    }

    function drawNumbers(ctx, radius) {
      ctx.font = radius * 0.15 + 'px SF Pro Display';
      ctx.textBaseline = 'middle';
      ctx.textAlign = 'center';
      ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--text');
      for (let num = 1; num <= 12; num++) {
        const ang = num * Math.PI / 6;
        ctx.rotate(ang);
        ctx.translate(0, -radius * 0.8);
        ctx.rotate(-ang);
        ctx.fillText(num.toString(), 0, 0);
        ctx.rotate(ang);
        ctx.translate(0, radius * 0.8);
        ctx.rotate(-ang);
      }
    }

    function drawTime(ctx, radius, now) {
      const ms = now.getMilliseconds();
      const second = now.getSeconds() + ms / 1000;
      const minute = now.getMinutes() + second / 60;
      const hour = (now.getHours() % 12) + minute / 60;

      drawHand(ctx, hour * Math.PI / 6, radius * 0.5, radius * 0.07);
      drawHand(ctx, minute * Math.PI / 30, radius * 0.75, radius * 0.06);
      drawHand(ctx, second * Math.PI / 30, radius * 0.85, radius * 0.02, '#ff3b30');
    }

    function drawHand(ctx, pos, length, width, color = getComputedStyle(document.body).getPropertyValue('--text')) {
      ctx.beginPath();
      ctx.lineWidth = width;
      ctx.lineCap = 'round';
      ctx.strokeStyle = color;
      ctx.moveTo(0, 0);
      ctx.rotate(pos);
      ctx.lineTo(0, -length);
      ctx.stroke();
      ctx.rotate(-pos);
    }

    countrySelect.addEventListener('change', async (e) => {
      selectedZone = e.target.value;
      await syncWithInternetTime();
    });

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(() => {
        try {
          const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
          selectedZone = tz;
          countrySelect.value = tz;
          syncWithInternetTime();
        } catch (e) {
          console.warn('Could not determine timezone');
        }
      });
    }

    themeToggle.addEventListener('click', () => {
      const currentTheme = document.body.getAttribute('data-theme');
      if (currentTheme === 'dark') {
        document.body.removeAttribute('data-theme');
        themeToggle.textContent = 'üåô Dark';
      } else {
        document.body.setAttribute('data-theme', 'dark');
        themeToggle.textContent = '‚òÄÔ∏è Light';
      }
    });

    startClock();
  </script>
</body>
</html>
